3PG Release Notes
=================


Date:               3th March 2003.
Software versions:  2.24

Anders Siggins/ Nicholas Coops
CSIRO FFP 
			

3PG is a forest growth model originally developed by Landsberg and
Waring (1997).

This software release of the 3-PG model has been developed to match
the Dr Peter Sands (CRC Sustainable Hardwood Production / CSIRO
Forestry and Forest Products) EXCEL version numbered '3PGpjs 1.0, 
3-PG March2000.24'. In addition it incorporates the 3-PG(S) version 
developed by Dr Nicholas Coops. As new versions of the EXCEL version 
are continually released, no guarantee can be made that the two models
will match exactly, though future updates may address the differences. 

The release is designed to read ARC/INFO (TM) floating point files to
allow spatial outputs of either model to be produced.

For further infomation or consultation on the 3-PG(S) models and their
use, please contact Dr Nicholas Coops, CSIRO FFP, Private Bag 10,
Clayton South 3169 Victoria, Australia; or via email to
N.Coops@ffp.csiro.au, http://www.ffp.csiro.au/nfm/mdp.


Disclaimer
~~~~~~~~~~

CSIRO accepts no responsibility for the use of 3PG(S) or of the model
3-PG in the form supplied or as subsequently modified by third
parties. CSIRO disclaims liability for all losses, damages and costs
incurred by any person as a result of relying on this software. Use of
this software assumes agreement to this condition of use.


Introduction
~~~~~~~~~~~~

This version of 3PG is based on the version published by Peter Sands
in the form of an Excel workbook with attached Visual Basic macros.
In addition this version incorporates the so-called '3PG satellite',
modifications, or 3PG(S), which allow the use of NDVI values to be
used to estimate fPAR and therefore canopy lighht interception and
utilisation.

In this implementation both modes of operation are available, and are
selected by an option in the command file. In these notes only the
name '3PG' is used, where a specific mode or version is being referred
to, this will be made clear in the context.

This version of 3PG is also capable of running in either single point
mode or grid mode. In point mode all of the parameters are single
values, and the output values are identical to those produced by the
Excel version. In grid mode some or all parameters may be given as
grids. In this mode the model is run on each grid point, sequentially,
and also writes specified output variables to new floating point
files. ARC/INFO grids currently must be converted to either 'floating
point' files or to BIL files to be read by 3PG, however, a future
version may be able to read and write Arc/Info grids directly.


Usage
~~~~~

3PG is a command line program, and its behaviour is controlled by
several command line options, specified in unix style.  The usage of
the program is:

  3pg -d default_file -s site_file

3PG reads input parameters from two text files. The parameters are
named to match the long, descriptive, parameter names, used in the
Excel version. While the two parameter files are referred to as the
'default' and the 'site' parameter files, there is virtually no
difference in the possible content of the files.  Two files are
allowed simply as a convenience, and to be similar to the structure of
the Excel version.


Parameter Files
~~~~~~~~~~~~~~~

Comments are allowed in the parameter file. Comments can appear almost
anywhere, must begin with two forward slash characters '//', and end
at the end of the line. Example parameter files are provided, which
amongst other things, give in the comments the short variable names
used in some parts of the Excel version.  Comments cannot be embedded
midway through multi-line parameters.  

The format of the parameter file is, in general, one parameter per
line, with the parameter name being enclosed in double quotes, and
white space seperating the parameter name and its value. For example:

  "Optimum temperature for growth"	25

sets the parameter to a constant value of 25. The case of the
parameter name is not significant.

The same parameters can be specified in both the default and site
files, with the site file being read last and taking precedence. If
any required parameter is left unset by both files an error will be
written and the program terminates.

The full list of parameters for 3PG mode is:

	"Foliage:stem partitioning ratio @ D=2 cm"        
	"Foliage:stem partitioning ratio @ D=20 cm"        
	"Constant in the stem mass v. diam. relationship"        
	"Power in the stem mass v. diam. relationship"        
	"Maximum fraction of NPP to roots"        
	"Minimum fraction of NPP to roots"        
	"Minimum temperature for growth"        
	"Optimum temperature for growth"        
	"Maximum temperature for growth"        
	"Days production lost per frost day"        
	"Moisture ratio deficit for fq = 0.5"        	
	"Power of moisture ratio deficit"        
	"Value of 'm' when FR = 0"        
	"Value of 'fNutr' when FR = 0"        
	"Power of (1-FR) in 'fNutr'"        
	"Maximum stand age used in age modifier"        
	"Power of relative age in function for fAge"        
	"Relative age to give fAge = 0.5"       
	"Maximum litterfall rate"        
	"Litterfall rate at t = 0"        
	"Age at which litterfall rate has median value"        
	"Average monthly root turnover rate"       
	"Maximum canopy conductance"       
	"LAI for maximum canopy conductance"        
	"Defines stomatal response to VPD"        
	"Canopy boundary layer conductance"        
	"Max. stem mass per tree @ 1000 trees/hectare"        
	"Power in self-thinning rule"        2
	"Fraction mean single-tree foliage biomass lost per dead tree"        
	"Fraction mean single-tree root biomass lost per dead tree"        
	"Fraction mean single-tree stem biomass lost per dead tree"        
	"Specific leaf area at age 0"        
	"Specific leaf area for mature leaves"        
	"Age at which specific leaf area = (SLA0+SLA1)/2"        
	"Extinction coefficient for absorption of PAR by canopy"        
	"Age at canopy cover"       
	"Maximum proportion of rainfall evaporated from canopy"        
	"LAI for maximum rainfall interception"        
	"Canopy quantum efficiency"        
	"Ratio NPP/GPP"       
	"Branch and bark fraction at age 0"        
	"Branch and bark fraction for mature stands"        
	"Age at which fracBB = (fracBB0+fracBB1)/2"        
	"Minimum basic density - for young trees"        
	"Maximum basic density - for older trees"        
	"Age at which rho = (rhoMin+rhoMax)/2"        
	"Intercept of net v. solar radiation relationship"        
	"Slope of net v. solar radiation relationship"        
	"Molecular weight of dry matter"        
	"Conversion of solar radiation to PAR"        


In 3PGS mode a further two parameters are required.  These have only a
short name:

    // 3PGS mode
    "NDVI_FPAR_intercept"
    "NDVI_FPAR_constant"


Series parameters
~~~~~~~~~~~~~~~~~

Some parameters have a slightly different format. The climatic
parameters, and the NDVI parameter, can be given in two formats.
These parameters are referred to as 'series' parameters.  The full
list of series parameters is:

  - Monthly means of maximum daily temperature (Tmax)
  - Monthly means of minimum daily temperature (Tmax)
  - Monthly mean rainfall (Rain)
  - Monthly mean short-wave radiation (Solar radtn)
  - Frost days per month (Frost)
  - Monthly mean net radiation (Net radtn)
  - Monthly mean vapour pressure deficit (VPD)
  - Monthly NDVI (NDVI_AVH)  

Note that the first 5 series parameters listed above are
mandatory. The next two, Net radiation and VPD, are optional, and if
provided override built in models of these two variables. The NDVI_AVH
parameter is required, and only allowed, in 3PGS mode

The first format for series parameters provides just 12 values, which
could be regarded as being for an average year.  In model runs of more
than 1 year these values will be used repeatedly. In this format a
series parameter takes the form of a climate keyword, followed by
whitespace, followed by 12 values. Each value can be either a constant
or a grid. For example, this line:

  "frost days" 0 0 0 0 0 fr06.bil fr07.bil 1 0 0 0 0

sets the value of frost days to be zero for all months of the year,
except June, July and August.  In June and July the value of frost
days will be obtained from grid files called fr06.bil and fro07.bil,
which allows the values of frost days to vary spatially for those two
months.

The second format for series parameters allows for climate values to
be associated with particular years, and for more than one year of
input. In this format the keyword must be on a line by itself,
followed lines containing a year, followed by 12 values. The series
must be terminated by a blank line. For example:

  "NDVI_AVH"
  1996 0 0 0 0 0 0 nv9607.flt nv9608.flt nv9609.flt nv9610.flt 0.81 0.78
  1997 0.75 nv9702.flt nv9703.flt 0.85 nv9705.flt nv9706.flt 0 0 0 0 0 0

This gives constant zero values to NDVI for the first 6 months of
1996, grid values for July to October, constant values for November to
January, grid values for February and March, a constant value for
April, and grid values for May and June.

In the NDVI parameter example above constant zero values are given for
some months. The reason for this is that while 3PG runs for a minimum
period of one year, in the southern hemisphere the model run starts in
July and ends in June. In this example, assuming a one year run
beginning in 1996, the values from January 1996 to June 1996 and June
1997 to December 1997 are not used.


Management tables
~~~~~~~~~~~~~~~~~

3PG can optionally make use of "management tables". These tables allow
arbitrary changes to be made to some of the model variables at
particular points in time, simulating the effect of management
actions. Three management tables are recognised, allowing control of
model variables representing fertility (FR), irrigation (Irrig) and
minimum available soil water (MinASW).  

Management tables in the C++ version of 3PG are completely analagous
to those in the Excel/VB version, with the one difference that the C++
version requires management tables to be listed in calendar years,
while the Excel/VB version requires tables listed by stand age. 

Management tables are indicated in the parameter file by one of the
three keyword phrases: "Management: fertility", "Management:
Irrigation", or "Management: MinASW". The keyphrase must appear on a
line on its own, followed on subsequent lines by the calendar year,
and the value of the management variable. Each value can be either a
grid file or a constant. For example:

  "Management: irrigation"
    1994  8
    1997  irr1997.flt
    2000  0

These tables work in exactly the same fashion as the Excel/VB
version. In the example above, if we assume that the "yearPlanted"
parameter has the value 1989, then for every year up to, but not
including, 1994, 8 ML/year of irrigation is applied, over the whole
run area. For the years 1994, 1995 and 1996, each cell will receive
the irrigation specified in the grid file irr1997.flt. If a cell
contains the NODATA value, the effect of the previous entry in the
management table persists. For the years 1998 and on, zero irrigation
is applied throughout the whole run area. This carry over of the last
entry of the management table duplicates the working of the Excel/VB
version.

To convert between the Excel/VB version management tables, and the C++
management tables, simply add the value of the "yearPlanted" paremeter. 
Assuming "yearPlanted" is 1989, the entries in the example table above 
would be listed with age 5, 8 and 11 in the Excel/VB version. 

The irrigation management variable can only be provided with a
management table. MinASW and fertility, however, can be provided both
as management tables and as ordinary parameters. In this case the
ordinary parameter value will take effect only where the management
table does not provide a value, such as a cell which has the value
NODATA in every entry in the management table.


The Log file
~~~~~~~~~~~~

3PG writes a log file, which contains some details of the progress of
the model, and is particularly usefull for finding problems in the
parameter files. The log file will be called "logfile.txt", and will
be written to the directory specified by the parameter "output path",
or the current directory should this parameter not be found.


Satellite Mode
~~~~~~~~~~~~~~

In satellite mode, 3PG uses supplied values of NDVI to estimate fPAR
at each monthly timestep, rather than estimating LAI from foliage
allocation. Satellite mode requires the parameter "Model mode" to have
the value "3PGS", and also requires the parameters NDVI_AVH,
NDVI_FPAR_int and NDVI_FPAR_const.  NDVI_AVH is a list of NDVI values,
while NDVI_FPAR_int and NDVI_FPAR_const are the intercept and constant
respectively, of a linear equation predicting FPAR as a function of
NDVI.


Outputs
~~~~~~~

The outputs available from 3PG depend on whether it is being used in
point or grid mode, and in standard or satellite mode. 

In point mode, the parameter "output file" is required, and gives the
name of an output file. All available output variables will be logged
in this file. In standard mode a large set of variables will be logged
on a one year timestep. In satellite mode 4 variables will be logged
on a monthly timestep. 

In grid mode, the parameter "output directory" gives a path to a
directory in which output grid files will be written. The output
variables are selected and named as demonstrated in the example
file. In standard mode 9 variables are available for output, and are
listed in the example file example2.txt. In satellite mode only 4
variables are available for output, and are listed in the example file
example3.txt.

In grid and standard mode the output variables are written at the end
of the model run. Grids of intermediate values can also be written, by
placing a start year and recurrence interval after the output grid
parameter. For example:

  "Weight of stems"    wstem.flt 1975 1 month 1

will cause the variable "weight of stems" to be written yearly on the 
first month of every year from 1975. The optional start year and
interval will cause intermediate values of the "weight of stems"
variable to be saved to grid files called wstem197501.flt,
wstem198001.flt, etc.  Using the keyword "monthly":  

  "Weight of stems" wstem.flt 1975 1 monthly

Will produce grids every month from 1975. 

The full list of output variables available in standard 3PG and
spatial modes is:

    short name     long name
    --------------------------------------
    "StemNo"       "Stocking density"
    "WF"           "Weight of foliage"
    "WR"           "Weight of roots"
    "WS"           "Weight of stems"
    "TotalW"       "Total weight"
    "MAI"          "Mean Annual Increment"
    "avDBH"        "Average DBH"
    "BasArea"      "Basal Area"
    "StandVol"     "Stand volume"
    "Transp"       "Transpiration"
    "ASW"          "Available Soil Water"
    "fSW"  		 "Soil water modifier"
    "fVPD"         "VPD modifier"
    "evaporation"  "Canopy Evaporation"
    "LAIx"  	 "Maximum Leaf Area Index"
    "ageLAIx"  	 "Age at Maximum Leaf Area"
    "LAI"          "Leaf Area Index"


The full list of output variables available in 3PGS and spatial modes
is:

    short name     long name
    --------------------------------------
    "NPP"          "Net Primary Production (tDM/ha)"
    "delWAG"       "change in aboveground biomass (tDM/ha)"
    "cumWabv"      "accumulated aboveground biomass (tDM/ha)"
    "LAI"          "Leaf Area Index"

In point mode the output variables are currently hard-wired and cannot
be set by the user.


Executables
~~~~~~~~~~~

Source code is provided for 3PG.  3PG depends on an interface library,
tentatively called 'jg_gridio', for reading and writing floating point
files and BIL files.  Source code is not provided for jg_gridio, as we
did not write it, and have yet to receive permission to re-distribute
it.

3PG is primarily developed on Windows 2000 with Microsoft Visual C++
6.0.  

In order to allow re-compilation of 3PG, we have provided jg_gridio as
a library. The library file "jg_grid.lib" has been included, along with 
the relevant header files. 


